---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout>
  <div class="container mx-auto px-6 py-24">
    <div class="mb-12">
      <a href="/#case-studies" class="text-accent hover:text-slate-900 transition-colors text-sm uppercase tracking-widest font-bold mb-8 inline-block">&larr; Back to Portfolio</a>
      <h1 class="text-3xl md:text-5xl font-bold text-slate-900 mb-6 tracking-tighter">Solace Event Topology</h1>
      <p class="text-slate-600 max-w-2xl text-lg">
        An event-driven architecture design featuring Solace PubSub+ creating a distributed Event Mesh. It illustrates how loosely coupled services publish events to topics, which are dynamically routed to consuming subscriber queues.
      </p>
    </div>

    <div class="bg-white border border-slate-200 shadow-sm rounded-2xl p-8 overflow-x-auto diagram-container">
      <div class="mermaid min-w-[800px] flex justify-center">
        graph LR
          subgraph Publishers[Event Publishers]
            Order[Order Service]
            Billing[Billing Service]
            User[User Service]
          end

          subgraph Mesh[Solace PubSub+ Event Mesh]
            Broker1((Broker Node 1))
            Broker2((Broker Node 2))
            Broker3((Broker Node 3))
            
            Broker1 --- Broker2
            Broker2 --- Broker3
            Broker3 --- Broker1
            
            Topic1[[orders/created]]
            Topic2[[billing/invoice/generated]]
            
            Broker1 -.-> Topic1
            Broker2 -.-> Topic2
          end

          subgraph Subscribers[Event Subscribers]
            Q1[(Order Queue)]
            Q2[(Audit Queue)]
            Q3[(Notification Queue)]
            
            OrderSync[ERP Sync App]
            AuditApp[Audit Logger]
            NotifApp[Email Service]
          end

          Order -->|Publish| Topic1
          Billing -->|Publish| Topic2
          
          Topic1 ==>|Route to Sub| Q1
          Topic1 ==>|Route to Sub| Q2
          Topic2 ==>|Route to Sub| Q3
          
          Q1 -->|Consume| OrderSync
          Q2 -->|Consume| AuditApp
          Q3 -->|Consume| NotifApp

          classDef pub fill:#eff6ff,stroke:#3b82f6,stroke-width:2px,color:#1d4ed8;
          classDef sub fill:#f0fdf4,stroke:#22c55e,stroke-width:2px,color:#15803d;
          classDef mesh fill:#fef2f2,stroke:#ef4444,stroke-width:2px,color:#b91c1c;
          
          class Publishers pub;
          class Subscribers sub;
          class Mesh mesh;
      </div>
    </div>
  </div>

  <script is:inline type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ 
      startOnLoad: true, 
      theme: 'base',
      themeVariables: {
        primaryColor: '#ffffff',
        primaryTextColor: '#1e293b',
        primaryBorderColor: '#cbd5e1',
        lineColor: '#94a3b8',
        secondaryColor: '#f8fafc',
        tertiaryColor: '#f1f5f9',
        fontFamily: 'system-ui, sans-serif'
      }
    });
  </script>
</BaseLayout>
